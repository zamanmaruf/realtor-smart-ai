<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RealtorSmart AI - Your Smart Real Estate Assistant</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Smart Real Estate Assistant with AI-powered property search and lead generation">
    <meta name="theme-color" content="#1e3a8a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="RealtorSmart AI">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/icon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icon-16.png">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/style.css">
    <style>
        /* Inline fallback styles */
        html, body {
            background: url('/real-estate-bg.jpeg') no-repeat center center fixed !important;
            background-size: cover !important;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        /* Ensure text is readable */
        .text-white, h1, h2, h3, p {
            color: white !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8) !important;
        }
        
        /* Property cards with better contrast */
        .property-card {
            background: rgba(255,255,255,0.95) !important;
            backdrop-filter: blur(10px) !important;
        }
    </style>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'GA_MEASUREMENT_ID');
    </script>
</head>
<body style="background: url('/real-estate-bg.jpeg') no-repeat center center fixed; background-size: cover; margin: 0; padding: 0; min-height: 100vh;">

    
    <!-- Language Selector -->
    <div class="fixed top-4 left-4 z-50">
        <select id="languageSelector" class="bg-gray-800 text-white px-3 py-2 rounded-lg shadow-lg hover:bg-gray-700 transition-colors">
            <option value="en">ðŸ‡ºðŸ‡¸ English</option>
            <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
            <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
            <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
            <option value="zh">ðŸ‡¨ðŸ‡³ ä¸­æ–‡</option>
        </select>
    </div>

    <!-- Dark Mode Toggle -->
    <button id="darkModeToggle" class="fixed top-4 right-4 z-50 bg-gray-800 text-white p-3 rounded-full shadow-lg hover:bg-gray-700 transition-colors">
        <svg id="sunIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
        </svg>
        <svg id="moonIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
        </svg>
    </button>

    <!-- Hero Section -->
    <section class="text-white py-20" style="background: transparent;">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-4xl md:text-6xl font-bold mb-6 hero-title" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.8); color: #ffffff;">
                RealtorSmart AI
            </h1>
            <p class="text-xl md:text-2xl mb-8 opacity-90 hero-subtitle" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8); color: #f0f8ff;">
                Your Smart Real Estate Assistant
            </p>
            <p class="text-lg mb-8 opacity-80 hero-description" style="text-shadow: 1px 1px 3px rgba(0,0,0,0.8); color: #e6f3ff;">
                Show listings, answer FAQs, and capture leads 24/7
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button onclick="scrollToSection('listings')" 
                        class="bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition duration-300">
                    Browse Listings
                </button>
                <button onclick="scrollToSection('chatbot')" 
                        class="border-2 border-white text-white px-8 py-3 rounded-lg font-semibold hover:bg-white hover:text-blue-600 transition duration-300">
                    Ask a Question
                </button>
            </div>
        </div>
    </section>

    <!-- Property Search & Filters Section -->
    <section id="search" class="py-12" style="background: transparent;">
        <div class="container mx-auto px-4">
            <div class="max-w-6xl mx-auto">
                <div class="bg-white rounded-lg shadow-lg p-6" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);">
                    <h3 class="text-2xl font-bold mb-6 text-center" style="color: #1e3a8a;">Find Your Perfect Home</h3>
                    
                    <!-- Search Bar -->
                    <div class="mb-6">
                        <div class="relative">
                            <input type="text" id="searchInput" placeholder="Search by address, neighborhood, or keywords..." 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <button onclick="performSearch()" class="absolute right-3 top-3 text-blue-600 hover:text-blue-800">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <!-- Price Range -->
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #374151;">Price Range</label>
                            <select id="priceRange" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Any Price</option>
                                <option value="0-300000">Under $300K</option>
                                <option value="300000-500000">$300K - $500K</option>
                                <option value="500000-750000">$500K - $750K</option>
                                <option value="750000-1000000">$750K - $1M</option>
                                <option value="1000000-999999999">$1M+</option>
                            </select>
                        </div>

                        <!-- Bedrooms -->
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #374151;">Bedrooms</label>
                            <select id="bedrooms" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Any</option>
                                <option value="1">1+</option>
                                <option value="2">2+</option>
                                <option value="3">3+</option>
                                <option value="4">4+</option>
                                <option value="5">5+</option>
                            </select>
                        </div>

                        <!-- Bathrooms -->
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #374151;">Bathrooms</label>
                            <select id="bathrooms" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Any</option>
                                <option value="1">1+</option>
                                <option value="2">2+</option>
                                <option value="3">3+</option>
                                <option value="4">4+</option>
                            </select>
                        </div>

                        <!-- Property Type -->
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #374151;">Property Type</label>
                            <select id="propertyType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Any Type</option>
                                <option value="house">House</option>
                                <option value="condo">Condo</option>
                                <option value="townhouse">Townhouse</option>
                                <option value="apartment">Apartment</option>
                            </select>
                        </div>
                    </div>

                    <!-- Additional Filters -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <!-- Square Footage -->
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #374151;">Min Square Feet</label>
                            <input type="number" id="minSqft" placeholder="e.g., 1000" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>

                        <!-- Year Built -->
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #374151;">Min Year Built</label>
                            <input type="number" id="minYear" placeholder="e.g., 1990" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>

                        <!-- Features -->
                        <div>
                            <label class="block text-sm font-medium mb-2" style="color: #374151;">Features</label>
                            <select id="features" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Any Features</option>
                                <option value="pool">Pool</option>
                                <option value="garage">Garage</option>
                                <option value="fireplace">Fireplace</option>
                                <option value="basement">Basement</option>
                            </select>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button onclick="applyFilters()" 
                                class="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                            Apply Filters
                        </button>
                        <button onclick="clearFilters()" 
                                class="border-2 border-gray-300 text-gray-700 px-8 py-3 rounded-lg font-semibold hover:bg-gray-50 transition duration-300">
                            Clear All
                        </button>
                        <button onclick="saveSearch()" 
                                class="border-2 border-green-600 text-green-600 px-8 py-3 rounded-lg font-semibold hover:bg-green-50 transition duration-300">
                            Save Search
                        </button>
                    </div>

                    <!-- Results Summary -->
                    <div id="searchResults" class="mt-6 text-center hidden">
                        <p class="text-lg font-semibold" style="color: #1e3a8a;">
                            Found <span id="resultCount">0</span> properties matching your criteria
                        </p>
                    </div>

                    <!-- Favorites Section -->
                    <div class="mt-6 border-t pt-6">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-semibold" style="color: #1e3a8a;">Your Favorites</h4>
                            <button onclick="viewFavorites()" 
                                    class="text-blue-600 hover:text-blue-800 font-medium">
                                View All Favorites
                            </button>
                        </div>
                        <div id="favoritesPreview" class="text-center text-gray-500">
                            <p>No favorites yet. Click the heart icon on any property to save it!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Property Listings Section -->
    <section id="listings" class="py-16" style="background: transparent;">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12" style="color: #1e3a8a; text-shadow: 1px 1px 2px rgba(255,255,255,0.8);">
                Featured Properties
            </h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Property 1 -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300 property-card transform hover:scale-105 cursor-pointer" onclick="openPropertyModal('property1')">
                    <div class="relative h-48 overflow-hidden">
                        <img src="/property1.jpg" alt="1234 Waterfront Drive" class="w-full h-full object-cover">
                        <div class="absolute top-2 left-2">
                            <span class="bg-green-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Just Listed</span>
                        </div>
                        <div class="absolute top-2 right-2">
                            <span class="bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Sea View</span>
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-semibold mb-2" style="color: #1e3a8a;">1234 Waterfront Drive</h3>
                        <p class="text-2xl font-bold text-blue-600 mb-4">$725,000</p>
                        <div class="flex justify-between mb-4" style="color: #374151;">
                            <span>3 Beds</span>
                            <span>2 Baths</span>
                            <span>1,800 sq ft</span>
                        </div>
                        <button onclick="scrollToSection('chatbot')" 
                                class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-300 btn-primary">
                            Inquire Now
                        </button>
                        <div class="flex gap-2 mt-2">
                            <button onclick="scrollToSection('mortgageCalculator')" 
                                    class="flex-1 border-2 border-blue-600 text-blue-600 py-2 rounded-lg hover:bg-blue-50 transition duration-300">
                                Calculate Mortgage
                            </button>
                            <button onclick="toggleFavorite('property1')" 
                                    class="px-3 py-2 border-2 border-red-500 text-red-500 rounded-lg hover:bg-red-50 transition duration-300 favorite-btn"
                                    data-property="property1">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>
                            <button onclick="shareProperty('property1')" 
                                    class="px-3 py-2 border-2 border-green-500 text-green-500 rounded-lg hover:bg-green-50 transition duration-300">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                                </svg>
                            </button>
                            <button onclick="printProperty('property1')" 
                                    class="px-3 py-2 border-2 border-purple-500 text-purple-500 rounded-lg hover:bg-purple-50 transition duration-300">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Property 2 -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300 property-card transform hover:scale-105 cursor-pointer" onclick="openPropertyModal('property2')">
                    <div class="relative h-48 overflow-hidden">
                        <img src="/property2.jpg" alt="5678 Oak Street" class="w-full h-full object-cover">
                        <div class="absolute top-2 left-2">
                            <span class="bg-red-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Reduced Price</span>
                        </div>
                        <div class="absolute top-2 right-2">
                            <span class="bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Family Home</span>
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-semibold mb-2" style="color: #1e3a8a;">5678 Oak Street</h3>
                        <p class="text-2xl font-bold text-blue-600 mb-4">$650,000</p>
                        <div class="flex justify-between mb-4" style="color: #374151;">
                            <span>4 Beds</span>
                            <span>3 Baths</span>
                            <span>2,200 sq ft</span>
                        </div>
                        <button onclick="scrollToSection('chatbot')" 
                                class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-300 btn-primary">
                            Inquire Now
                        </button>
                        <div class="flex gap-2 mt-2">
                            <button onclick="scrollToSection('mortgageCalculator')" 
                                    class="flex-1 border-2 border-blue-600 text-blue-600 py-2 rounded-lg hover:bg-blue-50 transition duration-300">
                                Calculate Mortgage
                            </button>
                            <button onclick="toggleFavorite('property2')" 
                                    class="px-3 py-2 border-2 border-red-500 text-red-500 rounded-lg hover:bg-red-50 transition duration-300 favorite-btn"
                                    data-property="property2">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>
                            <button onclick="shareProperty('property2')" 
                                    class="px-3 py-2 border-2 border-green-500 text-green-500 rounded-lg hover:bg-green-50 transition duration-300">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                                </svg>
                            </button>
                            <button onclick="printProperty('property2')" 
                                    class="px-3 py-2 border-2 border-purple-500 text-purple-500 rounded-lg hover:bg-purple-50 transition duration-300">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Property 3 -->
                <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition duration-300 property-card transform hover:scale-105 cursor-pointer" onclick="openPropertyModal('property3')">
                    <div class="relative h-48 overflow-hidden">
                        <img src="/property3.jpg" alt="9012 Maple Avenue" class="w-full h-full object-cover">
                        <div class="absolute top-2 left-2">
                            <span class="bg-orange-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Open House</span>
                        </div>
                        <div class="absolute top-2 right-2">
                            <span class="bg-teal-500 text-white px-2 py-1 rounded-full text-xs font-semibold">Starter Home</span>
                        </div>
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-semibold mb-2" style="color: #1e3a8a;">9012 Maple Avenue</h3>
                        <p class="text-2xl font-bold text-blue-600 mb-4">$550,000</p>
                        <div class="flex justify-between mb-4" style="color: #374151;">
                            <span>2 Beds</span>
                            <span>2 Baths</span>
                            <span>1,500 sq ft</span>
                        </div>
                        <button onclick="scrollToSection('chatbot')" 
                                class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition duration-300 btn-primary">
                            Inquire Now
                        </button>
                        <div class="flex gap-2 mt-2">
                            <button onclick="scrollToSection('mortgageCalculator')" 
                                    class="flex-1 border-2 border-blue-600 text-blue-600 py-2 rounded-lg hover:bg-blue-50 transition duration-300">
                                Calculate Mortgage
                            </button>
                            <button onclick="toggleFavorite('property3')" 
                                    class="px-3 py-2 border-2 border-red-500 text-red-500 rounded-lg hover:bg-red-50 transition duration-300 favorite-btn"
                                    data-property="property3">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>
                            <button onclick="shareProperty('property3')" 
                                    class="px-3 py-2 border-2 border-green-500 text-green-500 rounded-lg hover:bg-green-50 transition duration-300">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"></path>
                                </svg>
                            </button>
                            <button onclick="printProperty('property3')" 
                                    class="px-3 py-2 border-2 border-purple-500 text-purple-500 rounded-lg hover:bg-purple-50 transition duration-300">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Mortgage Calculator Section -->
    <section id="mortgageCalculator" class="py-16" style="background: transparent;">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12" style="color: #1e3a8a; text-shadow: 1px 1px 2px rgba(255,255,255,0.8);">
                Mortgage Calculator
            </h2>
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-lg shadow-lg p-8" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);">
                    <div class="grid md:grid-cols-2 gap-8">
                        <!-- Calculator Inputs -->
                        <div>
                            <h3 class="text-xl font-semibold mb-6" style="color: #1e3a8a;">Calculate Your Payment</h3>
                            <form id="mortgageCalculator" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium mb-2" style="color: #374151;">Home Price ($)</label>
                                    <input type="number" id="homePrice" name="homePrice" value="500000" min="10000" step="1000"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                           oninput="calculateMortgage()">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2" style="color: #374151;">Down Payment ($)</label>
                                    <input type="number" id="downPayment" name="downPayment" value="100000" min="0" step="1000"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                           oninput="calculateMortgage()">
                                    <div class="flex gap-2 mt-2">
                                        <button type="button" onclick="setDownPayment(10)" class="text-xs bg-gray-200 px-2 py-1 rounded hover:bg-gray-300">10%</button>
                                        <button type="button" onclick="setDownPayment(20)" class="text-xs bg-gray-200 px-2 py-1 rounded hover:bg-gray-300">20%</button>
                                        <button type="button" onclick="setDownPayment(25)" class="text-xs bg-gray-200 px-2 py-1 rounded hover:bg-gray-300">25%</button>
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2" style="color: #374151;">Interest Rate (%)</label>
                                    <input type="number" id="interestRate" name="interestRate" value="6.5" min="1" max="15" step="0.1"
                                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                           oninput="calculateMortgage()">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium mb-2" style="color: #374151;">Loan Term (Years)</label>
                                    <select id="loanTerm" name="loanTerm" 
                                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                            onchange="calculateMortgage()">
                                        <option value="15">15 Years</option>
                                        <option value="20">20 Years</option>
                                        <option value="30" selected>30 Years</option>
                                    </select>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Calculator Results -->
                        <div>
                            <h3 class="text-xl font-semibold mb-6" style="color: #1e3a8a;">Monthly Payment Estimate</h3>
                            <div class="bg-blue-50 rounded-lg p-6 mb-6">
                                <div class="text-center mb-4">
                                    <p class="text-sm text-gray-600">Monthly Payment</p>
                                    <p class="text-3xl font-bold text-blue-600" id="monthlyPayment">$2,528</p>
                                </div>
                                <div class="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <p class="text-gray-600">Principal & Interest</p>
                                        <p class="font-semibold" id="principalInterest">$2,528</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Property Tax (est.)</p>
                                        <p class="font-semibold" id="propertyTax">$417</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">Insurance (est.)</p>
                                        <p class="font-semibold" id="insurance">$125</p>
                                    </div>
                                    <div>
                                        <p class="text-gray-600">PMI (if applicable)</p>
                                        <p class="font-semibold" id="pmi">$0</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Loan Summary -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold mb-3" style="color: #1e3a8a;">Loan Summary</h4>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Loan Amount:</span>
                                        <span class="font-semibold" id="loanAmount">$400,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Down Payment %:</span>
                                        <span class="font-semibold" id="downPaymentPercent">20%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Total Interest:</span>
                                        <span class="font-semibold" id="totalInterest">$510,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">Total Cost:</span>
                                        <span class="font-semibold" id="totalCost">$910,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Disclaimer -->
                    <div class="mt-8 p-4 bg-yellow-50 rounded-lg">
                        <p class="text-sm text-yellow-800">
                            <strong>Disclaimer:</strong> This calculator provides estimates only. Actual payments may vary based on credit score, property taxes, insurance costs, and other factors. Please consult with a mortgage professional for accurate quotes.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Property Modal -->
    <div id="propertyModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto">
            <div class="relative">
                <button onclick="closePropertyModal()" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold z-10">
                    Ã—
                </button>
                <div id="modalContent" class="p-6">
                    <!-- Modal content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Lead Capture Section -->
    <section id="leadForm" class="py-16" style="background: transparent;">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12" style="color: #1e3a8a; text-shadow: 1px 1px 2px rgba(255,255,255,0.8);">
                Interested in a Property?
            </h2>
            <div class="max-w-2xl mx-auto">
                <form id="leadForm" class="bg-white p-8 rounded-lg shadow-lg" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Full Name *</label>
                            <input type="text" name="name" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                   pattern="[A-Za-z\s]+" title="Please enter a valid name (letters and spaces only)">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Email *</label>
                            <input type="email" name="email" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                   pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" title="Please enter a valid email address">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Phone *</label>
                            <input type="tel" name="phone" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
                                   pattern="[\+]?[1-9][\d]{0,15}" title="Please enter a valid phone number">
                        </div>
                        <div>
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Budget *</label>
                            <select name="budget" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="">Select Budget Range</option>
                                <option value="$300k - $500k">$300k - $500k</option>
                                <option value="$500k - $750k">$500k - $750k</option>
                                <option value="$750k - $1M">$750k - $1M</option>
                                <option value="$1M+">$1M+</option>
                            </select>
                        </div>
                        <div>
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Buying Timeline *</label>
                            <select name="timeline" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="">Select Timeline</option>
                                <option value="ASAP">ASAP</option>
                                <option value="1-3 months">1â€“3 months</option>
                                <option value="3-6 months">3â€“6 months</option>
                                <option value="Just browsing">Just browsing</option>
                            </select>
                        </div>
                        <div>
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Are you pre-approved? *</label>
                            <select name="preApproved" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="">Select Option</option>
                                <option value="Yes">Yes</option>
                                <option value="No">No</option>
                            </select>
                        </div>
                        <div>
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Type of Property *</label>
                            <select name="propertyType" required
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                                <option value="">Select Property Type</option>
                                <option value="Single-family">Single-family</option>
                                <option value="Condo">Condo</option>
                                <option value="Apartment">Apartment</option>
                                <option value="Duplex">Duplex</option>
                                <option value="Land">Land</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Preferred Location</label>
                            <input type="text" name="location" 
                                   placeholder="e.g., Downtown, Suburbs, Waterfront"
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                        </div>
                        
                        <!-- File Upload Section -->
                        <div class="md:col-span-2">
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Upload Documents (Optional)</label>
                            <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-blue-500 transition-colors">
                                <input type="file" id="documentUpload" name="documents" multiple 
                                       accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.txt"
                                       class="hidden" onchange="handleFileUpload(this)">
                                <label for="documentUpload" class="cursor-pointer">
                                    <svg class="w-12 h-12 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    <p class="text-lg font-medium" style="color: #1e3a8a;">Click to upload documents</p>
                                    <p class="text-sm text-gray-500 mt-1">PDF, DOC, DOCX, JPG, PNG, TXT (Max 10MB each)</p>
                                </label>
                            </div>
                            <div id="fileList" class="mt-3 space-y-2"></div>
                        </div>
                        
                        <!-- Additional Information -->
                        <div class="md:col-span-2">
                            <label class="block font-semibold mb-2" style="color: #1e3a8a;">Additional Information</label>
                            <textarea name="additionalInfo" rows="4" 
                                      placeholder="Tell us more about your requirements, preferences, or any specific questions..."
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 resize-none"></textarea>
                        </div>
                        
                        <!-- Marketing Preferences -->
                        <div class="md:col-span-2">
                            <div class="flex items-center mb-4">
                                <input type="checkbox" id="marketingConsent" name="marketingConsent" class="mr-3">
                                <label for="marketingConsent" class="text-sm text-gray-700">
                                    I agree to receive marketing communications from RealtorSmart AI
                                </label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="privacyConsent" name="privacyConsent" required class="mr-3">
                                <label for="privacyConsent" class="text-sm text-gray-700">
                                    I agree to the <a href="#" class="text-blue-600 hover:underline">Privacy Policy</a> and <a href="#" class="text-blue-600 hover:underline">Terms of Service</a> *
                                </label>
                            </div>
                        </div>
                        
                        <!-- Hidden field for marketing attribution -->
                        <input type="hidden" name="source" value="website">
                        <input type="hidden" name="referralCode" value="">
                    </div>
                    <div class="mt-6">
                        <button type="submit" 
                                class="w-full bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                            Submit Inquiry
                        </button>
                    </div>
                </form>
                <div id="leadSuccess" class="hidden mt-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg">
                    Thank you! One of our agents will get in touch shortly. Meanwhile, feel free to browse more listings.
                </div>
            </div>
        </div>
    </section>

    <!-- Google Maps Section -->
    <section class="py-16" style="background: transparent;">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12" style="color: #1e3a8a; text-shadow: 1px 1px 2px rgba(255,255,255,0.8);">
                Our Service Area
            </h2>
            <div class="max-w-4xl mx-auto">
                <div class="bg-gray-200 h-96 rounded-lg flex items-center justify-center">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2848.8444388087937!2d-63.5754!3d44.6488!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNDTCsDM4JzU2LjAiTiA2M8KwMzQnMzEuNCJX!5e0!3m2!1sen!2sca!4v1234567890"
                        width="100%" 
                        height="100%" 
                        style="border:0;" 
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade">
                    </iframe>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section class="py-16" style="background: transparent;">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12" style="color: #1e3a8a; text-shadow: 1px 1px 2px rgba(255,255,255,0.8);">
                What Our Clients Say
            </h2>
            <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
                <div class="bg-white p-6 rounded-lg shadow-lg" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold text-lg mr-4">
                            SM
                        </div>
                        <div>
                            <h4 class="font-semibold" style="color: #1e3a8a;">Sarah M.</h4>
                            <p class="text-sm text-gray-600">First-time Homebuyer</p>
                        </div>
                    </div>
                    <p class="text-gray-700 italic">"RealtorSmart AI helped me find my dream home in 2 days! The chatbot answered all my questions instantly and connected me with the perfect agent."</p>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-lg" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center text-white font-bold text-lg mr-4">
                            JD
                        </div>
                        <div>
                            <h4 class="font-semibold" style="color: #1e3a8a;">John D.</h4>
                            <p class="text-sm text-gray-600">Real Estate Agent</p>
                        </div>
                    </div>
                    <p class="text-gray-700 italic">"As a realtor, I'm blown away by how many leads this generates. The AI assistant handles initial inquiries perfectly while I focus on closing deals."</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Agent Profile Section -->
    <section class="py-16" style="background: transparent;">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12" style="color: #1e3a8a; text-shadow: 1px 1px 2px rgba(255,255,255,0.8);">
                Meet Your Agent
            </h2>
            <div class="max-w-4xl mx-auto">
                <div class="bg-white rounded-lg shadow-lg overflow-hidden" style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px);">
                    <div class="md:flex">
                        <div class="md:w-1/3">
                            <div class="h-64 md:h-full bg-gradient-to-br from-blue-600 to-purple-700 flex items-center justify-center">
                                <div class="text-center text-white">
                                    <div class="w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg class="w-16 h-16" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                        </svg>
                                    </div>
                                    <h3 class="text-xl font-bold">Michael Johnson</h3>
                                    <p class="text-blue-100">Licensed Real Estate Agent</p>
                                </div>
                            </div>
                        </div>
                        <div class="md:w-2/3 p-8">
                            <div class="mb-6">
                                <h3 class="text-2xl font-bold mb-4" style="color: #1e3a8a;">Michael Johnson</h3>
                                <p class="text-gray-600 mb-4">With over 8 years of experience in real estate, Michael specializes in residential properties and has helped hundreds of families find their perfect homes.</p>
                                <div class="grid grid-cols-2 gap-4 mb-6">
                                    <div>
                                        <p class="text-sm text-gray-500">License Number</p>
                                        <p class="font-semibold" style="color: #1e3a8a;">RE-123456</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">Experience</p>
                                        <p class="font-semibold" style="color: #1e3a8a;">8+ Years</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">Properties Sold</p>
                                        <p class="font-semibold" style="color: #1e3a8a;">150+</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-500">Client Satisfaction</p>
                                        <p class="font-semibold" style="color: #1e3a8a;">98%</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col sm:flex-row gap-4">
                                <a href="tel:+15551234567" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300 text-center">
                                    ðŸ“ž Call Now
                                </a>
                                <a href="https://wa.me/15551234567?text=Hi%20Michael%2C%20I'm%20interested%20in%20your%20properties!" target="_blank" class="bg-green-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 transition duration-300 text-center">
                                    ðŸ’¬ WhatsApp
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- WhatsApp CTA Button -->
    <div class="fixed bottom-4 right-4 z-50">
        <a href="https://wa.me/1234567890?text=Hi%2C%20I'm%20interested%20in%20your%20real%20estate%20listings!" 
           target="_blank"
           class="bg-green-500 text-white p-4 rounded-full shadow-lg hover:bg-green-600 transition duration-300">
            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
            </svg>
        </a>
    </div>

    <!-- Floating Chatbot Widget -->
    <div id="chatbot" class="fixed bottom-4 left-4 z-50">
        <div id="chatbotToggle" class="bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition duration-300 cursor-pointer">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
            </svg>
        </div>
        
                        <div id="chatbotWindow" class="hidden absolute bottom-16 left-0 w-80 h-96 bg-white rounded-lg shadow-xl border" style="background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px);">
            <div class="bg-blue-600 text-white p-4 rounded-t-lg">
                <div class="flex justify-between items-center">
                    <h3 class="font-semibold">RealtorSmart AI</h3>
                    <button id="closeChatbot" class="text-white hover:text-gray-200">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div id="chatMessages" class="h-64 overflow-y-auto p-4">
                <div class="text-center text-gray-500 text-sm">
                    Ask me anything about our properties!
                </div>
            </div>
            
            <div class="p-4 border-t">
                <div class="flex gap-2">
                    <input type="text" id="chatInput" placeholder="Type your message..." 
                           class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500">
                    <button id="sendMessage" 
                            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-300">
                        Send
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="/chatbot.js"></script>
    <script>
        // Property data for modals and search
        const propertyData = {
            property1: {
                title: "1234 Waterfront Drive",
                price: "$725,000",
                priceValue: 725000,
                beds: "3",
                baths: "2",
                sqft: "1,800",
                sqftValue: 1800,
                description: "Stunning waterfront property with panoramic ocean views. This modern 3-bedroom home features an open-concept design, gourmet kitchen with granite countertops, and a spacious master suite. The property includes a private dock, landscaped gardens, and a 2-car garage.",
                features: ["Ocean View", "Private Dock", "Gourmet Kitchen", "Master Suite", "2-Car Garage", "Landscaped Gardens"],
                image: "/property1.jpg",
                badges: ["Just Listed", "Sea View"],
                type: "house",
                yearBuilt: 2015,
                neighborhood: "Waterfront District"
            },
            property2: {
                title: "5678 Oak Street",
                price: "$650,000",
                priceValue: 650000,
                beds: "4",
                baths: "3",
                sqft: "2,200",
                sqftValue: 2200,
                description: "Spacious family home in a quiet, tree-lined neighborhood. This 4-bedroom property offers plenty of room for growing families with a large backyard, finished basement, and modern amenities throughout. Close to excellent schools and shopping centers.",
                features: ["4 Bedrooms", "Finished Basement", "Large Backyard", "Modern Kitchen", "Walk-in Closets", "Central AC"],
                image: "/property2.jpg",
                badges: ["Reduced Price", "Family Home"],
                type: "house",
                yearBuilt: 2010,
                neighborhood: "Oak Park"
            },
            property3: {
                title: "9012 Maple Avenue",
                price: "$550,000",
                priceValue: 550000,
                beds: "2",
                baths: "2",
                sqft: "1,500",
                sqftValue: 1500,
                description: "Perfect starter home or investment property. This charming 2-bedroom home has been recently updated with new appliances, fresh paint, and modern fixtures. Located in a convenient area with easy access to public transportation.",
                features: ["Recently Updated", "New Appliances", "Modern Fixtures", "Convenient Location", "Public Transport", "Investment Ready"],
                image: "/property3.jpg",
                badges: ["Open House", "Starter Home"],
                type: "condo",
                yearBuilt: 2020,
                neighborhood: "Maple Heights"
            }
        };

        // Property modal functions
        function openPropertyModal(propertyId) {
            const property = propertyData[propertyId];
            const modal = document.getElementById('propertyModal');
            const content = document.getElementById('modalContent');
            
            trackPropertyView(propertyId);
            
            content.innerHTML = `
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <img src="${property.image}" alt="${property.title}" class="w-full h-64 object-cover rounded-lg">
                        <div class="flex gap-2 mt-4">
                            ${property.badges.map(badge => `<span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm">${badge}</span>`).join('')}
                        </div>
                    </div>
                    <div>
                        <h2 class="text-3xl font-bold mb-4" style="color: #1e3a8a;">${property.title}</h2>
                        <p class="text-3xl font-bold text-blue-600 mb-4">${property.price}</p>
                        <div class="flex gap-6 mb-6">
                            <div class="text-center">
                                <p class="text-2xl font-bold" style="color: #1e3a8a;">${property.beds}</p>
                                <p class="text-gray-600">Beds</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold" style="color: #1e3a8a;">${property.baths}</p>
                                <p class="text-gray-600">Baths</p>
                            </div>
                            <div class="text-center">
                                <p class="text-2xl font-bold" style="color: #1e3a8a;">${property.sqft}</p>
                                <p class="text-gray-600">Sq Ft</p>
                            </div>
                        </div>
                        <p class="text-gray-700 mb-6">${property.description}</p>
                        <div class="mb-6">
                            <h4 class="font-semibold mb-3" style="color: #1e3a8a;">Key Features:</h4>
                            <div class="grid grid-cols-2 gap-2">
                                ${property.features.map(feature => `<div class="flex items-center">
                                    <svg class="w-4 h-4 text-green-500 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                                    </svg>
                                    <span class="text-sm">${feature}</span>
                                </div>`).join('')}
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <button onclick="scrollToSection('chatbot')" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                                Ask Questions
                            </button>
                            <button onclick="scrollToSection('leadForm')" class="border-2 border-blue-600 text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-blue-50 transition duration-300">
                                Schedule Viewing
                            </button>
                        </div>
                        
                        <!-- Mortgage Calculator in Modal -->
                        <div class="mt-8 border-t pt-6">
                            <h4 class="text-lg font-semibold mb-4" style="color: #1e3a8a;">Calculate Mortgage for ${property.title}</h4>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-1" style="color: #374151;">Home Price</label>
                                            <input type="number" id="modalHomePrice" value="${property.price.replace(/[$,]/g, '')}" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
                                                   oninput="calculateModalMortgage()">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1" style="color: #374151;">Down Payment</label>
                                            <input type="number" id="modalDownPayment" value="${Math.round(parseInt(property.price.replace(/[$,]/g, '')) * 0.2)}" 
                                                   class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
                                                   oninput="calculateModalMortgage()">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1" style="color: #374151;">Interest Rate (%)</label>
                                            <input type="number" id="modalInterestRate" value="6.5" min="1" max="15" step="0.1"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
                                                   oninput="calculateModalMortgage()">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-1" style="color: #374151;">Loan Term</label>
                                            <select id="modalLoanTerm" class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:border-blue-500"
                                                    onchange="calculateModalMortgage()">
                                                <option value="15">15 Years</option>
                                                <option value="20">20 Years</option>
                                                <option value="30" selected>30 Years</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <div class="bg-blue-50 rounded-lg p-4">
                                        <div class="text-center mb-3">
                                            <p class="text-sm text-gray-600">Monthly Payment</p>
                                            <p class="text-2xl font-bold text-blue-600" id="modalMonthlyPayment">$0</p>
                                        </div>
                                        <div class="space-y-2 text-sm">
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Principal & Interest:</span>
                                                <span class="font-semibold" id="modalPrincipalInterest">$0</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Property Tax (est.):</span>
                                                <span class="font-semibold" id="modalPropertyTax">$0</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">Insurance (est.):</span>
                                                <span class="font-semibold" id="modalInsurance">$0</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span class="text-gray-600">PMI (if applicable):</span>
                                                <span class="font-semibold" id="modalPMI">$0</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Calculate mortgage for the modal
            setTimeout(() => calculateModalMortgage(), 100);
        }

        function closePropertyModal() {
            const modal = document.getElementById('propertyModal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Enhanced form validation
        function validateForm() {
            const form = document.getElementById('leadForm');
            const inputs = form.querySelectorAll('input[required], select[required]');
            const checkboxes = form.querySelectorAll('input[type="checkbox"][required]');
            let isValid = true;

            // Validate required inputs
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    input.classList.add('border-red-500');
                    isValid = false;
                } else {
                    input.classList.remove('border-red-500');
                }

                // Email validation
                if (input.type === 'email' && input.value) {
                    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailPattern.test(input.value)) {
                        input.classList.add('border-red-500');
                        isValid = false;
                    }
                }

                // Phone validation
                if (input.type === 'tel' && input.value) {
                    const phonePattern = /^[\+]?[1-9][\d]{0,15}$/;
                    if (!phonePattern.test(input.value.replace(/\s/g, ''))) {
                        input.classList.add('border-red-500');
                        isValid = false;
                    }
                }
            });

            // Validate required checkboxes
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    checkbox.classList.add('border-red-500');
                    isValid = false;
                } else {
                    checkbox.classList.remove('border-red-500');
                }
            });

            // Validate file uploads
            const fileInput = document.getElementById('documentUpload');
            if (fileInput.files.length > 0) {
                for (let i = 0; i < fileInput.files.length; i++) {
                    const file = fileInput.files[i];
                    
                    // Check file size
                    if (file.size > 10 * 1024 * 1024) {
                        showNotification(`File ${file.name} is too large. Maximum size is 10MB.`, 'error');
                        isValid = false;
                    }
                    
                    // Check file type
                    const allowedTypes = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.txt'];
                    const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                    
                    if (!allowedTypes.includes(fileExtension)) {
                        showNotification(`File ${file.name} is not a supported format.`, 'error');
                        isValid = false;
                    }
                }
            }

            return isValid;
        }

        // Enhanced form submission
        document.getElementById('leadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                alert('Please fill in all required fields correctly.');
                return;
            }

            const formData = new FormData(this);
            const leadData = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                budget: formData.get('budget'),
                timeline: formData.get('timeline'),
                preApproved: formData.get('preApproved'),
                propertyType: formData.get('propertyType'),
                location: formData.get('location'),
                additionalInfo: formData.get('additionalInfo'),
                marketingConsent: formData.get('marketingConsent') === 'on',
                privacyConsent: formData.get('privacyConsent') === 'on',
                source: formData.get('source'),
                referralCode: formData.get('referralCode'),
                documents: formData.getAll('documents'),
                timestamp: new Date().toISOString()
            };

            try {
                const response = await fetch('/api/leads', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(leadData)
                });

                if (response.ok) {
                    document.getElementById('leadSuccess').classList.remove('hidden');
                    this.reset();
                    trackLeadSubmission();
                    setTimeout(() => {
                        document.getElementById('leadSuccess').classList.add('hidden');
                    }, 5000);
                } else {
                    alert('There was an error submitting your inquiry. Please try again.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('There was an error submitting your inquiry. Please try again.');
            }
        });

        // Utility functions
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Close modal when clicking outside
        document.getElementById('propertyModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePropertyModal();
            }
        });

        // Set referral code from URL parameters
        function setReferralCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const referralCode = urlParams.get('ref');
            if (referralCode) {
                document.querySelector('input[name="referralCode"]').value = referralCode;
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setReferralCode();
            calculateMortgage(); // Initialize calculator
        });

        // Mortgage Calculator Functions
        function calculateMortgage() {
            const homePrice = parseFloat(document.getElementById('homePrice').value) || 0;
            const downPayment = parseFloat(document.getElementById('downPayment').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const loanTerm = parseInt(document.getElementById('loanTerm').value) || 30;
            
            if (homePrice <= 0 || downPayment < 0 || interestRate <= 0) {
                return;
            }
            
            const loanAmount = homePrice - downPayment;
            const monthlyRate = interestRate / 100 / 12;
            const numberOfPayments = loanTerm * 12;
            
            // Calculate monthly principal & interest payment
            let monthlyPayment = 0;
            if (monthlyRate > 0) {
                monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            }
            
            // Calculate additional costs (estimates)
            const propertyTax = (homePrice * 0.01) / 12; // 1% annual property tax
            const insurance = (homePrice * 0.003) / 12; // 0.3% annual insurance
            const downPaymentPercent = (downPayment / homePrice) * 100;
            const pmi = downPaymentPercent < 20 ? (loanAmount * 0.005) / 12 : 0; // PMI if down payment < 20%
            
            const totalMonthlyPayment = monthlyPayment + propertyTax + insurance + pmi;
            
            // Calculate total interest and cost
            const totalInterest = (monthlyPayment * numberOfPayments) - loanAmount;
            const totalCost = homePrice + totalInterest;
            
            // Update display
            document.getElementById('monthlyPayment').textContent = formatCurrency(totalMonthlyPayment);
            document.getElementById('principalInterest').textContent = formatCurrency(monthlyPayment);
            document.getElementById('propertyTax').textContent = formatCurrency(propertyTax);
            document.getElementById('insurance').textContent = formatCurrency(insurance);
            document.getElementById('pmi').textContent = formatCurrency(pmi);
            document.getElementById('loanAmount').textContent = formatCurrency(loanAmount);
            document.getElementById('downPaymentPercent').textContent = downPaymentPercent.toFixed(1) + '%';
            document.getElementById('totalInterest').textContent = formatCurrency(totalInterest);
            document.getElementById('totalCost').textContent = formatCurrency(totalCost);
        }
        
        function calculateModalMortgage() {
            const homePrice = parseFloat(document.getElementById('modalHomePrice').value) || 0;
            const downPayment = parseFloat(document.getElementById('modalDownPayment').value) || 0;
            const interestRate = parseFloat(document.getElementById('modalInterestRate').value) || 0;
            const loanTerm = parseInt(document.getElementById('modalLoanTerm').value) || 30;
            
            if (homePrice <= 0 || downPayment < 0 || interestRate <= 0) {
                return;
            }
            
            const loanAmount = homePrice - downPayment;
            const monthlyRate = interestRate / 100 / 12;
            const numberOfPayments = loanTerm * 12;
            
            // Calculate monthly principal & interest payment
            let monthlyPayment = 0;
            if (monthlyRate > 0) {
                monthlyPayment = loanAmount * (monthlyRate * Math.pow(1 + monthlyRate, numberOfPayments)) / (Math.pow(1 + monthlyRate, numberOfPayments) - 1);
            }
            
            // Calculate additional costs (estimates)
            const propertyTax = (homePrice * 0.01) / 12; // 1% annual property tax
            const insurance = (homePrice * 0.003) / 12; // 0.3% annual insurance
            const downPaymentPercent = (downPayment / homePrice) * 100;
            const pmi = downPaymentPercent < 20 ? (loanAmount * 0.005) / 12 : 0; // PMI if down payment < 20%
            
            const totalMonthlyPayment = monthlyPayment + propertyTax + insurance + pmi;
            
            // Update modal display
            document.getElementById('modalMonthlyPayment').textContent = formatCurrency(totalMonthlyPayment);
            document.getElementById('modalPrincipalInterest').textContent = formatCurrency(monthlyPayment);
            document.getElementById('modalPropertyTax').textContent = formatCurrency(propertyTax);
            document.getElementById('modalInsurance').textContent = formatCurrency(insurance);
            document.getElementById('modalPMI').textContent = formatCurrency(pmi);
        }
        
        function setDownPayment(percent) {
            const homePrice = parseFloat(document.getElementById('homePrice').value) || 0;
            const downPayment = (homePrice * percent) / 100;
            document.getElementById('downPayment').value = Math.round(downPayment);
            calculateMortgage();
        }
        
        function formatCurrency(amount) {
            return '$' + Math.round(amount).toLocaleString();
        }

        // Property Search and Filtering Functions

        function performSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredProperties = Object.values(propertyData).filter(property => 
                property.title.toLowerCase().includes(searchTerm) ||
                property.neighborhood.toLowerCase().includes(searchTerm) ||
                property.description.toLowerCase().includes(searchTerm)
            );
            
            updateSearchResults(filteredProperties.length);
            highlightSearchResults(searchTerm);
            trackSearch(searchTerm);
        }

        function applyFilters() {
            const priceRange = document.getElementById('priceRange').value;
            const bedrooms = document.getElementById('bedrooms').value;
            const bathrooms = document.getElementById('bathrooms').value;
            const propertyType = document.getElementById('propertyType').value;
            const minSqft = document.getElementById('minSqft').value;
            const minYear = document.getElementById('minYear').value;
            const features = document.getElementById('features').value;

            let filteredProperties = Object.values(propertyData).filter(property => {
                // Price range filter
                if (priceRange && priceRange !== '') {
                    const [minPrice, maxPrice] = priceRange.split('-').map(Number);
                    if (property.priceValue < minPrice || property.priceValue > maxPrice) {
                        return false;
                    }
                }

                // Bedrooms filter
                if (bedrooms && parseInt(property.beds) < parseInt(bedrooms)) {
                    return false;
                }

                // Bathrooms filter
                if (bathrooms && parseInt(property.baths) < parseInt(bathrooms)) {
                    return false;
                }

                // Property type filter
                if (propertyType && property.type !== propertyType) {
                    return false;
                }

                // Square footage filter
                if (minSqft && property.sqftValue < parseInt(minSqft)) {
                    return false;
                }

                // Year built filter
                if (minYear && property.yearBuilt < parseInt(minYear)) {
                    return false;
                }

                // Features filter
                if (features && !property.features.some(f => f.toLowerCase().includes(features.toLowerCase()))) {
                    return false;
                }

                return true;
            });

            updateSearchResults(filteredProperties.length);
            highlightFilteredProperties(filteredProperties);
        }

        function clearFilters() {
            document.getElementById('searchInput').value = '';
            document.getElementById('priceRange').value = '';
            document.getElementById('bedrooms').value = '';
            document.getElementById('bathrooms').value = '';
            document.getElementById('propertyType').value = '';
            document.getElementById('minSqft').value = '';
            document.getElementById('minYear').value = '';
            document.getElementById('features').value = '';
            
            // Reset all property cards
            const propertyCards = document.querySelectorAll('.property-card');
            propertyCards.forEach(card => {
                card.style.opacity = '1';
                card.style.transform = 'scale(1)';
            });
            
            document.getElementById('searchResults').classList.add('hidden');
        }

        function saveSearch() {
            const searchCriteria = {
                searchTerm: document.getElementById('searchInput').value,
                priceRange: document.getElementById('priceRange').value,
                bedrooms: document.getElementById('bedrooms').value,
                bathrooms: document.getElementById('bathrooms').value,
                propertyType: document.getElementById('propertyType').value,
                minSqft: document.getElementById('minSqft').value,
                minYear: document.getElementById('minYear').value,
                features: document.getElementById('features').value,
                timestamp: new Date().toISOString()
            };

            // Save to localStorage
            const savedSearches = JSON.parse(localStorage.getItem('savedSearches') || '[]');
            savedSearches.push(searchCriteria);
            localStorage.setItem('savedSearches', JSON.stringify(savedSearches));

            // Show success message
            showNotification('Search saved successfully!', 'success');
        }

        function updateSearchResults(count) {
            const resultsDiv = document.getElementById('searchResults');
            const countSpan = document.getElementById('resultCount');
            
            countSpan.textContent = count;
            resultsDiv.classList.remove('hidden');
            
            if (count === 0) {
                countSpan.textContent = 'No properties found';
            }
        }

        function highlightSearchResults(searchTerm) {
            const propertyCards = document.querySelectorAll('.property-card');
            
            propertyCards.forEach(card => {
                const title = card.querySelector('h3').textContent.toLowerCase();
                const matches = title.includes(searchTerm.toLowerCase());
                
                if (searchTerm && !matches) {
                    card.style.opacity = '0.3';
                    card.style.transform = 'scale(0.95)';
                } else {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }
            });
        }

        function highlightFilteredProperties(filteredProperties) {
            const propertyCards = document.querySelectorAll('.property-card');
            
            propertyCards.forEach(card => {
                const propertyId = card.getAttribute('onclick').match(/property\d+/)[0];
                const isVisible = filteredProperties.some(prop => prop.title === propertyData[propertyId].title);
                
                if (filteredProperties.length > 0 && !isVisible) {
                    card.style.opacity = '0.3';
                    card.style.transform = 'scale(0.95)';
                } else {
                    card.style.opacity = '1';
                    card.style.transform = 'scale(1)';
                }
            });
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-blue-500 text-white'
            }`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Add keyboard support for search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });

        // Auto-apply filters when values change
        document.querySelectorAll('#priceRange, #bedrooms, #bathrooms, #propertyType, #minSqft, #minYear, #features').forEach(element => {
            element.addEventListener('change', applyFilters);
        });

        // Favorites functionality
        function toggleFavorite(propertyId) {
            event.stopPropagation(); // Prevent modal from opening
            
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const isFavorite = favorites.includes(propertyId);
            
            if (isFavorite) {
                // Remove from favorites
                const index = favorites.indexOf(propertyId);
                favorites.splice(index, 1);
                showNotification('Removed from favorites', 'info');
            } else {
                // Add to favorites
                favorites.push(propertyId);
                showNotification('Added to favorites!', 'success');
                trackFavorite(propertyId);
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoriteButtons();
            updateFavoritesPreview();
        }

        function updateFavoriteButtons() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            document.querySelectorAll('.favorite-btn').forEach(btn => {
                const propertyId = btn.getAttribute('data-property');
                const isFavorite = favorites.includes(propertyId);
                
                if (isFavorite) {
                    btn.classList.remove('border-red-500', 'text-red-500', 'hover:bg-red-50');
                    btn.classList.add('border-red-600', 'text-red-600', 'bg-red-50', 'hover:bg-red-100');
                    btn.querySelector('svg').innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" fill="currentColor"></path>';
                } else {
                    btn.classList.remove('border-red-600', 'text-red-600', 'bg-red-50', 'hover:bg-red-100');
                    btn.classList.add('border-red-500', 'text-red-500', 'hover:bg-red-50');
                    btn.querySelector('svg').innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>';
                }
            });
        }

        // Initialize favorites on page load
        document.addEventListener('DOMContentLoaded', function() {
            setReferralCode();
            calculateMortgage(); // Initialize calculator
            updateFavoriteButtons(); // Initialize favorite buttons
            updateFavoritesPreview(); // Initialize favorites preview
            
            // Track page view
            trackEvent('page_view', 'homepage');
            
            // Register Service Worker for PWA
            registerServiceWorker();
            
            // Check for PWA install prompt
            checkForPWAInstall();
            
            // Initialize push notifications
            initializePushNotifications();
            
            // Initialize dark mode
            initializeDarkMode();
            
            // Initialize language support
            initializeLanguage();
        });

        // Analytics Functions
        function trackEvent(action, label, value) {
            if (typeof gtag !== 'undefined') {
                gtag('event', action, {
                    event_category: 'realtor_smart_ai',
                    event_label: label,
                    value: value
                });
            }
        }

        function trackPropertyView(propertyId) {
            trackEvent('property_view', propertyId);
        }

        function trackLeadSubmission() {
            trackEvent('lead_submission', 'contact_form');
        }

        function trackSearch(searchTerm) {
            trackEvent('search', searchTerm);
        }

        function trackFavorite(propertyId) {
            trackEvent('favorite', propertyId);
        }

        function trackShare(platform, propertyId) {
            trackEvent('share', `${platform}_${propertyId}`);
        }

        function trackPrint(propertyId) {
            trackEvent('print', propertyId);
        }

        // PWA Functions
        async function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('Service Worker registered:', registration);
                } catch (error) {
                    console.log('Service Worker registration failed:', error);
                }
            }
        }

        function checkForPWAInstall() {
            let deferredPrompt;
            
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                
                // Show install button
                showInstallButton();
            });
            
            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed');
                hideInstallButton();
            });
        }

        function showInstallButton() {
            // Create install button if it doesn't exist
            if (!document.getElementById('pwaInstallBtn')) {
                const installBtn = document.createElement('button');
                installBtn.id = 'pwaInstallBtn';
                installBtn.innerHTML = 'ðŸ“± Install App';
                installBtn.className = 'fixed bottom-4 right-4 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 hover:bg-blue-700 transition-colors';
                installBtn.onclick = installPWA;
                document.body.appendChild(installBtn);
            }
        }

        function hideInstallButton() {
            const installBtn = document.getElementById('pwaInstallBtn');
            if (installBtn) {
                installBtn.remove();
            }
        }

        async function installPWA() {
            if (window.deferredPrompt) {
                window.deferredPrompt.prompt();
                const { outcome } = await window.deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    console.log('User accepted the install prompt');
                }
                window.deferredPrompt = null;
                hideInstallButton();
            }
        }

        // Offline functionality
        async function saveOfflineLead(formData) {
            if ('serviceWorker' in navigator && 'sync' in window.ServiceWorkerRegistration.prototype) {
                try {
                    const db = await openIndexedDB();
                    await db.add('offline-leads', {
                        id: Date.now().toString(),
                        data: formData,
                        timestamp: new Date().toISOString()
                    });
                    
                    // Register background sync
                    const registration = await navigator.serviceWorker.ready;
                    await registration.sync.register('background-sync');
                    
                    showNotification('Form saved for offline submission', 'info');
                } catch (error) {
                    console.error('Error saving offline:', error);
                }
            }
        }

        function openIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('RealtorSmartAI', 1);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => resolve(request.result);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('offline-leads')) {
                        db.createObjectStore('offline-leads', { keyPath: 'id' });
                    }
                };
            });
        }

        // Push Notification Functions
        async function initializePushNotifications() {
            if ('serviceWorker' in navigator && 'PushManager' in window) {
                try {
                    // Get VAPID public key
                    const response = await fetch('/api/push/vapidPublicKey');
                    const data = await response.json();
                    
                    if (data.success) {
                        // Check if user has already subscribed
                        const subscription = await getPushSubscription();
                        if (!subscription) {
                            showNotificationButton();
                        }
                    }
                } catch (error) {
                    console.error('Error initializing push notifications:', error);
                }
            }
        }

        function showNotificationButton() {
            if (!document.getElementById('notificationBtn')) {
                const notificationBtn = document.createElement('button');
                notificationBtn.id = 'notificationBtn';
                notificationBtn.innerHTML = 'ðŸ”” Enable Notifications';
                notificationBtn.className = 'fixed bottom-4 left-4 bg-green-600 text-white px-4 py-2 rounded-lg shadow-lg z-50 hover:bg-green-700 transition-colors';
                notificationBtn.onclick = subscribeToNotifications;
                document.body.appendChild(notificationBtn);
            }
        }

        async function subscribeToNotifications() {
            try {
                const registration = await navigator.serviceWorker.ready;
                
                // Get VAPID public key
                const response = await fetch('/api/push/vapidPublicKey');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error('Failed to get VAPID key');
                }
                
                // Subscribe to push notifications
                const subscription = await registration.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: urlBase64ToUint8Array(data.publicKey)
                });
                
                // Send subscription to server
                const subscribeResponse = await fetch('/api/push/subscribe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ subscription })
                });
                
                const subscribeData = await subscribeResponse.json();
                
                if (subscribeData.success) {
                    showNotification('Notifications enabled!', 'success');
                    hideNotificationButton();
                } else {
                    throw new Error('Failed to subscribe');
                }
                
            } catch (error) {
                console.error('Error subscribing to notifications:', error);
                showNotification('Failed to enable notifications', 'error');
            }
        }

        async function getPushSubscription() {
            try {
                const registration = await navigator.serviceWorker.ready;
                return await registration.pushManager.getSubscription();
            } catch (error) {
                console.error('Error getting push subscription:', error);
                return null;
            }
        }

        function hideNotificationButton() {
            const notificationBtn = document.getElementById('notificationBtn');
            if (notificationBtn) {
                notificationBtn.remove();
            }
        }

        // Convert VAPID key
        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding)
                .replace(/-/g, '+')
                .replace(/_/g, '/');

            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);

            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }

        // Dark Mode Functions
        function initializeDarkMode() {
            const darkModeToggle = document.getElementById('darkModeToggle');
            const sunIcon = document.getElementById('sunIcon');
            const moonIcon = document.getElementById('moonIcon');
            
            // Check for saved dark mode preference
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            
            if (isDarkMode) {
                enableDarkMode();
            }
            
            darkModeToggle.addEventListener('click', toggleDarkMode);
        }

        function toggleDarkMode() {
            const isDarkMode = document.documentElement.classList.contains('dark');
            
            if (isDarkMode) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        }

        function enableDarkMode() {
            document.documentElement.classList.add('dark');
            localStorage.setItem('darkMode', 'true');
            updateDarkModeIcons(true);
        }

        function disableDarkMode() {
            document.documentElement.classList.remove('dark');
            localStorage.setItem('darkMode', 'false');
            updateDarkModeIcons(false);
        }

        function updateDarkModeIcons(isDark) {
            const sunIcon = document.getElementById('sunIcon');
            const moonIcon = document.getElementById('moonIcon');
            
            if (isDark) {
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        }

        // Language Support Functions
        const translations = {
            en: {
                heroTitle: "RealtorSmart AI",
                heroSubtitle: "Your Smart Real Estate Assistant",
                heroDescription: "Show listings, answer FAQs, and capture leads 24/7",
                browseListings: "Browse Listings",
                askQuestion: "Ask a Question",
                findPerfectHome: "Find Your Perfect Home",
                searchPlaceholder: "Search by address, neighborhood, or keywords...",
                priceRange: "Price Range",
                anyPrice: "Any Price",
                bedrooms: "Bedrooms",
                any: "Any",
                bathrooms: "Bathrooms",
                propertyType: "Property Type",
                anyType: "Any Type",
                applyFilters: "Apply Filters",
                clearAll: "Clear All",
                saveSearch: "Save Search",
                viewAllFavorites: "View All Favorites",
                yourFavorites: "Your Favorites",
                propertyListings: "Property Listings",
                contactUs: "Contact Us",
                name: "Name",
                email: "Email",
                phone: "Phone",
                budget: "Budget",
                timeline: "Buying Timeline",
                preApproved: "Are you pre-approved?",
                propertyTypeForm: "Type of Property",
                location: "Location",
                additionalInfo: "Additional Information",
                uploadDocuments: "Upload Documents (Optional)",
                marketingConsent: "I agree to receive marketing communications",
                privacyConsent: "I agree to the privacy policy",
                submit: "Submit Inquiry",
                mortgageCalculator: "Mortgage Calculator",
                homePrice: "Home Price",
                downPayment: "Down Payment",
                interestRate: "Interest Rate (%)",
                loanTerm: "Loan Term (years)",
                calculate: "Calculate",
                monthlyPayment: "Monthly Payment",
                loanSummary: "Loan Summary",
                principal: "Principal",
                interest: "Interest",
                propertyTax: "Property Tax",
                insurance: "Insurance",
                pmi: "PMI",
                total: "Total"
            },
            es: {
                heroTitle: "RealtorSmart AI",
                heroSubtitle: "Tu Asistente Inmobiliario Inteligente",
                heroDescription: "Muestra listados, responde preguntas y captura leads 24/7",
                browseListings: "Ver Propiedades",
                askQuestion: "Hacer Pregunta",
                findPerfectHome: "Encuentra tu Hogar Perfecto",
                searchPlaceholder: "Buscar por direcciÃ³n, barrio o palabras clave...",
                priceRange: "Rango de Precio",
                anyPrice: "Cualquier Precio",
                bedrooms: "Habitaciones",
                any: "Cualquiera",
                bathrooms: "BaÃ±os",
                propertyType: "Tipo de Propiedad",
                anyType: "Cualquier Tipo",
                applyFilters: "Aplicar Filtros",
                clearAll: "Limpiar Todo",
                saveSearch: "Guardar BÃºsqueda",
                viewAllFavorites: "Ver Todos los Favoritos",
                yourFavorites: "Tus Favoritos",
                propertyListings: "Listados de Propiedades",
                contactUs: "ContÃ¡ctanos",
                name: "Nombre",
                email: "Correo",
                phone: "TelÃ©fono",
                budget: "Presupuesto",
                timeline: "Cronograma de Compra",
                preApproved: "Â¿EstÃ¡s pre-aprobado?",
                propertyTypeForm: "Tipo de Propiedad",
                location: "UbicaciÃ³n",
                additionalInfo: "InformaciÃ³n Adicional",
                uploadDocuments: "Subir Documentos (Opcional)",
                marketingConsent: "Acepto recibir comunicaciones de marketing",
                privacyConsent: "Acepto la polÃ­tica de privacidad",
                submit: "Enviar Consulta",
                mortgageCalculator: "Calculadora de Hipoteca",
                homePrice: "Precio de la Casa",
                downPayment: "Pago Inicial",
                interestRate: "Tasa de InterÃ©s (%)",
                loanTerm: "Plazo del PrÃ©stamo (aÃ±os)",
                calculate: "Calcular",
                monthlyPayment: "Pago Mensual",
                loanSummary: "Resumen del PrÃ©stamo",
                principal: "Principal",
                interest: "InterÃ©s",
                propertyTax: "Impuesto Predial",
                insurance: "Seguro",
                pmi: "PMI",
                total: "Total"
            }
        };

        function initializeLanguage() {
            const languageSelector = document.getElementById('languageSelector');
            
            // Check for saved language preference
            const savedLanguage = localStorage.getItem('language') || 'en';
            languageSelector.value = savedLanguage;
            
            // Apply saved language
            changeLanguage(savedLanguage);
            
            // Add event listener
            languageSelector.addEventListener('change', (e) => {
                const language = e.target.value;
                changeLanguage(language);
                localStorage.setItem('language', language);
            });
        }

        function changeLanguage(language) {
            const lang = translations[language] || translations.en;
            
            // Update hero section
            document.querySelector('.hero-title').textContent = lang.heroTitle;
            document.querySelector('.hero-subtitle').textContent = lang.heroSubtitle;
            document.querySelector('.hero-description').textContent = lang.heroDescription;
            
            // Update buttons
            const browseBtn = document.querySelector('[onclick="scrollToSection(\'listings\')"]');
            const askBtn = document.querySelector('[onclick="scrollToSection(\'chatbot\')"]');
            if (browseBtn) browseBtn.textContent = lang.browseListings;
            if (askBtn) askBtn.textContent = lang.askQuestion;
            
            // Update search section
            const searchTitle = document.querySelector('#search h3');
            const searchInput = document.getElementById('searchInput');
            if (searchTitle) searchTitle.textContent = lang.findPerfectHome;
            if (searchInput) searchInput.placeholder = lang.searchPlaceholder;
            
            // Update form labels
            updateFormLabels(lang);
            
            // Update calculator
            updateCalculatorLabels(lang);
        }

        function updateFormLabels(lang) {
            const labels = document.querySelectorAll('label');
            labels.forEach(label => {
                const text = label.textContent.toLowerCase();
                if (text.includes('name')) label.textContent = lang.name;
                else if (text.includes('email')) label.textContent = lang.email;
                else if (text.includes('phone')) label.textContent = lang.phone;
                else if (text.includes('budget')) label.textContent = lang.budget;
                else if (text.includes('timeline')) label.textContent = lang.timeline;
                else if (text.includes('pre-approved')) label.textContent = lang.preApproved;
                else if (text.includes('type of property')) label.textContent = lang.propertyTypeForm;
                else if (text.includes('location')) label.textContent = lang.location;
                else if (text.includes('additional information')) label.textContent = lang.additionalInfo;
                else if (text.includes('upload documents')) label.textContent = lang.uploadDocuments;
            });
        }

        function updateCalculatorLabels(lang) {
            const calculatorLabels = document.querySelectorAll('#mortgageCalculator label');
            calculatorLabels.forEach(label => {
                const text = label.textContent.toLowerCase();
                if (text.includes('home price')) label.textContent = lang.homePrice;
                else if (text.includes('down payment')) label.textContent = lang.downPayment;
                else if (text.includes('interest rate')) label.textContent = lang.interestRate;
                else if (text.includes('loan term')) label.textContent = lang.loanTerm;
            });
        }

        function updateFavoritesPreview() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const previewDiv = document.getElementById('favoritesPreview');
            
            if (favorites.length === 0) {
                previewDiv.innerHTML = '<p class="text-gray-500">No favorites yet. Click the heart icon on any property to save it!</p>';
                return;
            }
            
            const favoriteProperties = favorites.slice(0, 3).map(id => propertyData[id]).filter(Boolean);
            
            if (favoriteProperties.length === 0) {
                previewDiv.innerHTML = '<p class="text-gray-500">No favorites yet. Click the heart icon on any property to save it!</p>';
                return;
            }
            
            const previewHTML = favoriteProperties.map(property => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg mb-2">
                    <div class="flex items-center">
                        <img src="${property.image}" alt="${property.title}" class="w-12 h-12 object-cover rounded mr-3">
                        <div>
                            <p class="font-semibold text-sm" style="color: #1e3a8a;">${property.title}</p>
                            <p class="text-sm text-gray-600">${property.price}</p>
                        </div>
                    </div>
                    <button onclick="toggleFavorite('${Object.keys(propertyData).find(key => propertyData[key] === property)}')" 
                            class="text-red-500 hover:text-red-700">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
            
            previewDiv.innerHTML = previewHTML;
        }

        function viewFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            if (favorites.length === 0) {
                showNotification('You have no favorites yet!', 'info');
                return;
            }
            
            // Create a modal to show all favorites
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-96 overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold" style="color: #1e3a8a;">Your Favorite Properties</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="space-y-4">
                        ${favorites.map(id => {
                            const property = propertyData[id];
                            if (!property) return '';
                            return `
                                <div class="border rounded-lg p-4">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center">
                                            <img src="${property.image}" alt="${property.title}" class="w-16 h-16 object-cover rounded mr-4">
                                            <div>
                                                <h4 class="font-semibold" style="color: #1e3a8a;">${property.title}</h4>
                                                <p class="text-lg font-bold text-blue-600">${property.price}</p>
                                                <p class="text-sm text-gray-600">${property.beds} beds, ${property.baths} baths, ${property.sqft} sq ft</p>
                                            </div>
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="openPropertyModal('${id}')" 
                                                    class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
                                                View Details
                                            </button>
                                            <button onclick="toggleFavorite('${id}')" 
                                                    class="px-4 py-2 text-red-500 hover:text-red-700">
                                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.remove();
                }
            });
        }

        // Social Sharing Functions
        function shareProperty(propertyId) {
            event.stopPropagation(); // Prevent modal from opening
            
            const property = propertyData[propertyId];
            if (!property) return;
            
            const shareData = {
                title: property.title,
                text: `Check out this amazing property: ${property.title} - ${property.price}`,
                url: `${window.location.origin}?property=${propertyId}`
            };
            
            // Create share modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold" style="color: #1e3a8a;">Share Property</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="mb-4">
                        <img src="${property.image}" alt="${property.title}" class="w-full h-32 object-cover rounded mb-3">
                        <h4 class="font-semibold" style="color: #1e3a8a;">${property.title}</h4>
                        <p class="text-lg font-bold text-blue-600">${property.price}</p>
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="shareOnFacebook('${propertyId}')" 
                                class="flex items-center justify-center gap-2 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                            </svg>
                            Facebook
                        </button>
                        <button onclick="shareOnTwitter('${propertyId}')" 
                                class="flex items-center justify-center gap-2 bg-blue-400 text-white px-4 py-2 rounded hover:bg-blue-500">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                            </svg>
                            Twitter
                        </button>
                        <button onclick="shareOnLinkedIn('${propertyId}')" 
                                class="flex items-center justify-center gap-2 bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800">
                            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                            </svg>
                            LinkedIn
                        </button>
                        <button onclick="shareViaEmail('${propertyId}')" 
                                class="flex items-center justify-center gap-2 bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                            </svg>
                            Email
                        </button>
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <button onclick="copyShareLink('${propertyId}')" 
                                class="w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                            Copy Link
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close modal when clicking outside
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.remove();
                }
            });
        }

        function shareOnFacebook(propertyId) {
            const property = propertyData[propertyId];
            const url = encodeURIComponent(`${window.location.origin}?property=${propertyId}`);
            const text = encodeURIComponent(`Check out this amazing property: ${property.title} - ${property.price}`);
            window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
            trackShare('facebook', propertyId);
        }

        function shareOnTwitter(propertyId) {
            const property = propertyData[propertyId];
            const url = encodeURIComponent(`${window.location.origin}?property=${propertyId}`);
            const text = encodeURIComponent(`Check out this amazing property: ${property.title} - ${property.price}`);
            window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
        }

        function shareOnLinkedIn(propertyId) {
            const property = propertyData[propertyId];
            const url = encodeURIComponent(`${window.location.origin}?property=${propertyId}`);
            const title = encodeURIComponent(property.title);
            const summary = encodeURIComponent(`Check out this amazing property: ${property.title} - ${property.price}`);
            window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}&title=${title}&summary=${summary}`, '_blank');
        }

        function shareViaEmail(propertyId) {
            const property = propertyData[propertyId];
            const subject = encodeURIComponent(`Amazing Property: ${property.title}`);
            const body = encodeURIComponent(`Hi,\n\nI found this amazing property that might interest you:\n\n${property.title}\nPrice: ${property.price}\n${property.beds} beds, ${property.baths} baths, ${property.sqft} sq ft\n\nView it here: ${window.location.origin}?property=${propertyId}\n\nBest regards`);
            window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
        }

        function copyShareLink(propertyId) {
            const url = `${window.location.origin}?property=${propertyId}`;
            navigator.clipboard.writeText(url).then(() => {
                showNotification('Link copied to clipboard!', 'success');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = url;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Link copied to clipboard!', 'success');
            });
        }

        // File Upload Functions
        function handleFileUpload(input) {
            const fileList = document.getElementById('fileList');
            const files = input.files;
            
            fileList.innerHTML = '';
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // Validate file size (10MB limit)
                if (file.size > 10 * 1024 * 1024) {
                    showNotification(`File ${file.name} is too large. Maximum size is 10MB.`, 'error');
                    continue;
                }
                
                // Validate file type
                const allowedTypes = ['.pdf', '.doc', '.docx', '.jpg', '.jpeg', '.png', '.txt'];
                const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
                
                if (!allowedTypes.includes(fileExtension)) {
                    showNotification(`File ${file.name} is not a supported format.`, 'error');
                    continue;
                }
                
                // Create file item
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                fileItem.innerHTML = `
                    <div class="flex items-center">
                        <svg class="w-5 h-5 text-gray-500 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <span class="text-sm font-medium">${file.name}</span>
                        <span class="text-xs text-gray-500 ml-2">(${formatFileSize(file.size)})</span>
                    </div>
                    <button onclick="removeFile(this)" class="text-red-500 hover:text-red-700">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                `;
                
                fileList.appendChild(fileItem);
            }
            
            if (files.length > 0) {
                showNotification(`${files.length} file(s) uploaded successfully!`, 'success');
            }
        }

        function removeFile(button) {
            const fileItem = button.closest('div');
            fileItem.remove();
            
            // Update the file input
            const fileInput = document.getElementById('documentUpload');
            const dt = new DataTransfer();
            
            // Recreate the FileList without the removed file
            for (let i = 0; i < fileInput.files.length; i++) {
                const file = fileInput.files[i];
                // This is a simplified approach - in a real app, you'd track which files to keep
                dt.items.add(file);
            }
            
            fileInput.files = dt.files;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Print Property Functions
        function printProperty(propertyId) {
            event.stopPropagation(); // Prevent modal from opening
            
            const property = propertyData[propertyId];
            if (!property) return;
            
            trackPrint(propertyId);
            
            // Create print-friendly content
            const printContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Property Report - ${property.title}</title>
                    <style>
                        @media print {
                            body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
                            .header { text-align: center; border-bottom: 2px solid #1e3a8a; padding-bottom: 20px; margin-bottom: 30px; }
                            .property-image { width: 100%; max-width: 400px; height: 250px; object-fit: cover; margin: 20px auto; display: block; }
                            .property-details { margin: 20px 0; }
                            .property-details h2 { color: #1e3a8a; font-size: 24px; margin-bottom: 10px; }
                            .price { font-size: 28px; font-weight: bold; color: #2563eb; margin: 15px 0; }
                            .specs { display: flex; justify-content: space-between; margin: 20px 0; }
                            .spec-item { text-align: center; }
                            .spec-value { font-size: 20px; font-weight: bold; color: #1e3a8a; }
                            .spec-label { color: #6b7280; font-size: 14px; }
                            .description { margin: 20px 0; line-height: 1.6; }
                            .features { margin: 20px 0; }
                            .features h3 { color: #1e3a8a; margin-bottom: 10px; }
                            .feature-list { list-style: none; padding: 0; }
                            .feature-list li { padding: 5px 0; }
                            .feature-list li:before { content: "âœ“ "; color: #10b981; font-weight: bold; }
                            .contact-info { margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; }
                            .contact-info h3 { color: #1e3a8a; margin-bottom: 10px; }
                            .footer { margin-top: 40px; text-align: center; color: #6b7280; font-size: 12px; }
                            @page { margin: 1in; }
                        }
                        body { font-family: Arial, sans-serif; }
                        .header { text-align: center; border-bottom: 2px solid #1e3a8a; padding-bottom: 20px; margin-bottom: 30px; }
                        .property-image { width: 100%; max-width: 400px; height: 250px; object-fit: cover; margin: 20px auto; display: block; }
                        .property-details { margin: 20px 0; }
                        .property-details h2 { color: #1e3a8a; font-size: 24px; margin-bottom: 10px; }
                        .price { font-size: 28px; font-weight: bold; color: #2563eb; margin: 15px 0; }
                        .specs { display: flex; justify-content: space-between; margin: 20px 0; }
                        .spec-item { text-align: center; }
                        .spec-value { font-size: 20px; font-weight: bold; color: #1e3a8a; }
                        .spec-label { color: #6b7280; font-size: 14px; }
                        .description { margin: 20px 0; line-height: 1.6; }
                        .features { margin: 20px 0; }
                        .features h3 { color: #1e3a8a; margin-bottom: 10px; }
                        .feature-list { list-style: none; padding: 0; }
                        .feature-list li { padding: 5px 0; }
                        .feature-list li:before { content: "âœ“ "; color: #10b981; font-weight: bold; }
                        .contact-info { margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; }
                        .contact-info h3 { color: #1e3a8a; margin-bottom: 10px; }
                        .footer { margin-top: 40px; text-align: center; color: #6b7280; font-size: 12px; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1 style="color: #1e3a8a; margin: 0;">RealtorSmart AI</h1>
                        <p style="color: #6b7280; margin: 5px 0;">Property Report</p>
                        <p style="color: #6b7280; margin: 5px 0;">Generated on ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <div class="property-details">
                        <h2>${property.title}</h2>
                        <div class="price">${property.price}</div>
                        
                        <div class="specs">
                            <div class="spec-item">
                                <div class="spec-value">${property.beds}</div>
                                <div class="spec-label">Bedrooms</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-value">${property.baths}</div>
                                <div class="spec-label">Bathrooms</div>
                            </div>
                            <div class="spec-item">
                                <div class="spec-value">${property.sqft}</div>
                                <div class="spec-label">Square Feet</div>
                            </div>
                        </div>
                        
                        <div class="description">
                            <h3 style="color: #1e3a8a;">Description</h3>
                            <p>${property.description}</p>
                        </div>
                        
                        <div class="features">
                            <h3>Key Features</h3>
                            <ul class="feature-list">
                                ${property.features.map(feature => `<li>${feature}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="contact-info">
                            <h3>Contact Information</h3>
                            <p><strong>RealtorSmart AI</strong></p>
                            <p>Phone: (555) 123-4567</p>
                            <p>Email: info@realtorsmart.ai</p>
                            <p>Website: realtorsmart.ai</p>
                        </div>
                        
                        <div class="footer">
                            <p>This property report was generated by RealtorSmart AI</p>
                            <p>For more information, visit realtorsmart.ai</p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            // Create a new window for printing
            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.document.close();
            
            // Wait for content to load, then print
            printWindow.onload = function() {
                printWindow.print();
                printWindow.close();
            };
            
            showNotification('Print dialog opened!', 'success');
        }
    </script>
</body>
</html> 